---
title: 도커파일
date: 2025-12-11
tags:
  - it
  - 인프라
  - 컨테이너
  - 도커
  - 도커파일
---

# Dockerfile 예제

```Dockerfile
FROM ubuntu:22.04

LABEL maintainer="Foo Bar <foo@bar.com>"
LABEL description="Nginx Server with basic hardening and optimized layers"

# 비대화형 설치 환경
ENV DEBIAN_FRONTEND=noninteractive

# 패키지 설치 및 이미지 최적화
RUN apt update && \
    apt install -y nginx curl tzdata && \
    apt clean && rm -rf /var/lib/apt/lists/*

# nginx 데몬 모드 설정 변경
RUN echo "\ndaemon off;" >> /etc/nginx/nginx.conf

# nginx 권한 설정
RUN chown -R www-data:www-data /var/lib/nginx

# 타임존 설정
ENV TZ=Asia/Seoul

# 헬스체크: 서버 상태 자동 확인
HEALTHCHECK --interval=30s --timeout=5s --retries=3 \
    CMD curl -f http://localhost/ || exit 1

# 컨테이너 외부 공유 볼륨
VOLUME ["/data", "/etc/nginx/site-enabled", "/var/log/nginx"]

# 로그를 Docker stdout/stderr 로 연결
RUN ln -sf /dev/stdout /var/log/nginx/access.log && \
    ln -sf /dev/stderr /var/log/nginx/error.log

# 기본 작업 디렉터리
WORKDIR /etc/nginx

# 컨테이너 시작 시 실행할 명령
CMD ["nginx"]

# 노출할 포트
EXPOSE 80
EXPOSE 443
```

---

# 명령어별 설명과 이유

|명령|역할|설명|
|---|---|---|
|**FROM**|기반 이미지 지정|이미지는 기존 이미지를 기반으로 누적 생성된다.|
|**LABEL**|메타 정보 추가|MAINTAINER 대신 LABEL 사용이 표준. 빌드·관리 도구에서 유용하다.|
|**ENV**|환경 변수 설정|비대화형 설치 문제 방지, 타임존 설정 등 핵심 환경을 통제한다.|
|**RUN**|이미지 생성 단계에서 명령 실행|패키지 설치, 설정 파일 변경 등에 사용. 여러 RUN을 하나로 묶으면 레이어가 줄어든다.|
|**apt clean & rm -rf**|이미지 최적화|apt 캐시 제거로 이미지 사이즈 감소.|
|**HEALTHCHECK**|컨테이너 상태 자동 감지|상태 이상 시 자동 재시작 시스템과 연계할 수 있음.|
|**VOLUME**|호스트와 공유할 디렉터리|설정 파일·데이터·로그를 외부에 저장할 때 사용.|
|**WORKDIR**|작업 디렉터리|CMD나 ENTRYPOINT 실행 기준 디렉터리 설정.|
|**CMD**|컨테이너 시작 시 실행될 명령|여러 명령이 있을 때 가장 마지막 CMD만 적용됨.|
|**EXPOSE**|컨테이너 포트 정의|실제 포트 연결은 docker run -p 옵션으로 지정.|
|**로그 symlink**|운영 로그 보기 편하게 설정|docker logs 로 바로 확인 가능하도록 변경.|

---

# 핵심 개념 총정리

## 1. Dockerfile은 이미지 생성의 설계도

하나의 Dockerfile → 빌드 → 불변 이미지 생성  
이미지 실행 → 컨테이너 생성

## 2. RUN, CMD, ENTRYPOINT의 명확한 차이

- **RUN**: 이미지 빌드 시 실행
    
- **CMD**: 컨테이너 실행 시 실행
    
- **ENTRYPOINT**: CMD와 조합 가능, 기본 실행 명령을 강제할 때 사용
    

## 3. Dockerfile에서 중요하게 고려할 점

- 이미지는 가벼울수록 좋다 → apt 캐시 제거, 레이어 최소화
    
- 환경변수로 불필요한 대화형 설치 방지
    
- 로그는 파일이 아닌 stdout/stderr로 보내는 것이 운영 표준
    
- healthcheck는 컨테이너 안정성 확보의 핵심
    
- 볼륨 분리는 운영 환경에서 매우 중요 (데이터 보존)
    

## 4. 최신 Docker 권장 패턴

- `MAINTAINER` 대신 `LABEL` 사용
    
- RUN 명령 chaining (`&&`) 사용해 레이어 최소화
    
- apt 설치 후 캐시 제거로 이미지 축소
    
- 헬스체크 추가
    
- 로그는 stdout/stderr로 리다이렉트
    


