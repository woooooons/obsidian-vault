---
title: 보안
date: 2025-12-18
tags:
  - it
  - 인프라
  - 웹서버
  - apache
  - 보안
---
# Apache 보안 설정 체크리스트

## 1. 프로세스 권한 분리 (필수 통과)

### 설정 상태

- **Master 프로세스**: root (포트 바인딩/관리)
- **Worker 프로세스**: www-data (요청 처리)

### 확인 명령

```bash
ps aux | grep apache2
```

### 판단 기준

- o root + www-data 혼재 → **정상**
- X worker가 root → **치명적 오류**

---

## 2. 실행 사용자/그룹 관리 (변수 기반, 표준)

### 설정 방식

```apache
User ${APACHE_RUN_USER}
Group ${APACHE_RUN_GROUP}
```

### 실제 값 확인

```bash
grep APACHE_RUN /etc/apache2/envvars
```

### 기대 출력

```bash
APACHE_RUN_USER=www-data
APACHE_RUN_GROUP=www-data
```

### 판단

- Ubuntu/Debi → O 정상
- 파일 내용 표시 → X 실패

---

## 4. 디렉터리 리스팅(Indexes) 완전 차단

### 설정 확인

```bash
grep -R "Indexes" /etc/apache2/
```

### 유효 설정

```apache
Options -Indexes -FollowSymLinks
```

### 테스트

빈 디렉터리 접근 시:

```bash
mkdir /var/www/html/test
curl http://localhost/test/
```

- 403 → O 통과
- 파일 목록 표시 → X 실패

---

## 5. userdir(~user) 기능 리스크 관리

### 위험 요소

- `/home/*/public_html` 외부 노출 가능
- 개인 정보 유출 위험

### 모듈 비활성화

```bash
# 현재 상태 확인
apache2ctl -M | grep userdir

# 비활성화
sudo a2dismod userdir
sudo systemctl reload apache2
```

### 확인

```bash
apache2ctl -M | grep userdir
```

- 출력 없음 → O 정상

---

## 6. 서버 정보 노출 최소화

### ServerTokens 설정

```apache
ServerTokens Prod
```

### ServerSignature 설정

```apache
ServerSignature Off
```

### 설정 위치

```bash
# security.conf 또는 apache2.conf에 추가
sudo nano /etc/apache2/conf-available/security.conf
```

### 효과

- 에러 페이지에서 Apache 버전 정보 숨김
- HTTP 헤더에서 상세 정보 제거

### 확인

```bash
curl -I http://localhost/nonexistent
```

- `Server: Apache` → O 정상
- `Server: Apache/2.4.52 (Ubuntu)` → X 정보 노출

---

## 7. HTTP 메서드 제한

### 설정

```apache
<Directory /var/www/html>
    <LimitExcept GET POST HEAD>
        Require all denied
    </LimitExcept>
</Directory>
```

### 효과

- TRACE, DELETE, PUT 등 위험한 메서드 차단

### 확인

```bash
curl -X TRACE http://localhost/
curl -X DELETE http://localhost/
```

- 405 Method Not Allowed → O 정상

---

## 8. 불필요 모듈 비활성화

### 점검 대상 모듈

```bash
# 현재 활성화된 모듈 확인
apache2ctl -M
```

### 비활성화 권장

```bash
# 자동 인덱싱
sudo a2dismod autoindex

# 서버 상태 정보
sudo a2dismod status

# CGI (미사용 시)
sudo a2dismod cgi

# 재시작
sudo systemctl reload apache2
```

---

## 9. 민감 파일 접근 차단

### .git, .env, 백업 파일 보호

```apache
<DirectoryMatch "^\.|\/\.">
    Require all denied
</DirectoryMatch>

<FilesMatch "\.(bak|config|sql|log|old|backup|swp)$">
    Require all denied
</FilesMatch>
```

### 효과

- `.git` 디렉터리 노출 방지
- `.env` 환경 변수 파일 보호
- 백업 파일 접근 차단

---

## 10. 타임아웃 설정

### 설정

```apache
Timeout 60
KeepAliveTimeout 5
```

### 효과

- Slowloris 공격 완화
- 리소스 고갈 방지

---

## 11. 로그 관리

### 접근 로그 확인

```bash
tail -f /var/log/apache2/access.log
```

### 에러 로그 모니터링

```bash
tail -f /var/log/apache2/error.log
```

### 로그 권한 설정

```bash
sudo chmod 640 /var/log/apache2/*.log
sudo chown root:adm /var/log/apache2/*.log
```

---

## 12. SSL/TLS 설정 (HTTPS 사용 시)

### 강력한 암호화 설정

```apache
SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
SSLCipherSuite HIGH:!aNULL:!MD5:!3DES
SSLHonorCipherOrder on
```

### HTTP Strict Transport Security (HSTS)

```apache
Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
```

---

## 13. 불필요/유령 설정 파일 영향 제거

### 점검

```bash
# apache2copy.conf 등 확인
grep -R "apache2copy.conf" /etc/apache2/

# 실제 Include 여부 확인
grep -R "Include.*apache2copy" /etc/apache2/
```

### 판단

- Include 없음 → **실행 영향 0**
- 보안 영향 없음

### 정리 (선택)

```bash
sudo mv /etc/apache2/apache2copy.conf /etc/apache2/apache2copy.conf.bak
```

---

## 14. Apache manual / 예제 노출 여부

### 점검

```bash
sudo find /etc/apache2 -type f -name "*manual*"
ls /usr/share/doc/apache2/
```

### manual 모듈 비활성화

```bash
apache2ctl -M | grep manual
sudo a2disconf apache2-doc
sudo systemctl reload apache2
```

### 판단

- 출력 없음 → O **정보 노출 요소 없음**

---

## 15. 서비스 동작 검증

### 설정 문법 검사

```bash
sudo apachectl configtest
```

- O `Syntax OK` 필수

### 설정 재적용

```bash
sudo systemctl reload apache2
```

### 서비스 상태 확인

```bash
sudo systemctl status apache2
```

---

## 종합 보안 점검 스크립트

```bash
#!/bin/bash
echo "=== Apache 보안 점검 시작 ==="

echo -e "\n[1] 프로세스 권한 확인"
ps aux | grep apache2 | grep -v grep

echo -e "\n[2] 실행 사용자 확인"
grep APACHE_RUN /etc/apache2/envvars

echo -e "\n[3] Indexes 설정 확인"
grep -R "Indexes" /etc/apache2/ 2>/dev/null | grep -v "#"

echo -e "\n[4] userdir 모듈 확인"
apache2ctl -M | grep userdir

echo -e "\n[5] ServerTokens 확인"
grep ServerTokens /etc/apache2/conf-available/security.conf

echo -e "\n[6] 활성화된 모듈"
apache2ctl -M

echo -e "\n[7] 설정 문법 검사"
sudo apachectl configtest

echo -e "\n=== 점검 완료 ==="
```

